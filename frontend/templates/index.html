<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alfred Assistant</title>

    <!-- Collega il file CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    
    <h1>Welcome to Alfred</h1>

    <!-- Sezione per ottenere il meteo -->
    <input type="text" id="cityInput" placeholder="Enter city">
    <button onclick="getWeather()">Get Weather</button>

    <p id="weatherResponse"></p>

    <input type="text" id="commandInput" placeholder="Type a command">
    <button onclick="sendCommand()">Send Command</button>
    <button onclick="startVoiceRecognition()">Use Voice</button>

    <!-- Sezione per inserire il nome della canzone -->
    <input type="text" id="songInput" placeholder="Enter song name">
    <button onclick="playSong()">Play Song</button>
    <button onclick="pauseSong()">Pause Song</button>

    <p id="songResponse"></p>


    <!-- Riquadro per data e ora in tempo reale -->
    <div id="datetime-box">
        <p id="date"></p>
        <p id="time"></p>
    </div>


    <p id="response"></p>

    <script>

        // Funzione per inviare una richiesta di riproduzione al backend
        function playSong() {
            const songName = document.getElementById('songInput').value;
            fetch('/api/play-song', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ song_name: songName })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('songResponse').innerText = data.error;
                } else {
                    document.getElementById('songResponse').innerText = data.result;
                }
            })
            .catch(error => console.error('Error:', error));
        }


        // Funzione per inviare una richiesta di pausa al backend
        function pauseSong() {
            fetch('/api/pause-song', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('songResponse').innerText = data.error;
                } else {
                    document.getElementById('songResponse').innerText = data.result;
                }
            })
            .catch(error => console.error('Error:', error));
        }

        
        // Funzione per ottenere il meteo
        function getWeather() {
            const city = document.getElementById('cityInput').value;
            fetch('/api/weather', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ city: city })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('weatherResponse').innerText = data.error;
                } else {
                    document.getElementById('weatherResponse').innerText = 
                        `In ${data.city}, it's currently ${data.temperature}Â°C with ${data.description}.`;
                }
            })
            .catch(error => console.error('Error:', error));
        }

        // Funzione per inviare un comando al backend
        function sendCommand() {
            const command = document.getElementById('commandInput').value;
            fetch('/api/command', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ command: command })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('response').innerText = data.result || data.error;
            })
            .catch(error => console.error('Error:', error));
        }

        // Funzione per iniziare il riconoscimento vocale
        function startVoiceRecognition() {
            fetch('/api/voice-command', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.command) {
                    document.getElementById('commandInput').value = data.command;
                    sendCommand(); // Invia automaticamente il comando riconosciuto
                } else {
                    document.getElementById('response').innerText = data.error;
                }
            })
            .catch(error => console.error('Error:', error));
        }
   
        
        // Funzione per ottenere data e ora in tempo reale
        function updateDateTime() {
            const now = new Date();
            
            // Opzioni per formattare giorno e mese abbreviati
            const dateOptions = { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' };
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit' };

            const formattedDate = now.toLocaleDateString('en-US', dateOptions);
            const formattedTime = now.toLocaleTimeString('en-US', timeOptions);

            // Aggiorna gli elementi HTML con la data e l'ora formattate
            document.getElementById('date').innerText = formattedDate;
            document.getElementById('time').innerText = formattedTime;
        }

        // Esegui updateDateTime ogni secondo
        setInterval(updateDateTime, 1000);

        // Chiamata iniziale per mostrare subito la data e l'ora all'apertura della pagina
        updateDateTime();
   
   </script>
</body>
</html>
